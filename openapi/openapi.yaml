openapi: 3.0.3

info:
  version: 1.0.0
  title: üöó[AOS 2023] Inventario de Recambios del taller üöó
  description: >
    ## üöò API REST para la gesti√≥n de inventario de taller de coches
  license:
    name: MIT
    url: 'https://opensource.org/licenses/MIT'
servers:
  - url: http://127.0.0.1:80/api/v1
tags:
  - name: '‚öôÔ∏èInventario'

paths:
  /recambios:
    get:
      summary: Obtiene todos los recambios
      description: |
        La siguiente tabla define los c√≥digos de estado que puede devolver este endpoint
        
        | Status Code | Descripci√≥n | Motivo                             |
        | ------------| ------------| -----------------------------------|
        | **200**     | OK          | Listado de los recambios           |
        | **404**     | NOT FOUND   | No hay ningun recambio             |
      operationId: recambio_cget
      tags: [ '‚öôÔ∏èInventario' ]
      responses:
        '200':
          description: Lista de recambios disponibles
          headers:
            ETag:
              $ref: '#/components/headers/Etag'
          content:
            application/json:
              schema:
                type: object
                properties:
                  Recambios:
                    description: array de recambios
                    type: array
                    items:
                      $ref: '#/components/schemas/Recambio'
              examples:
                plataformas-example:
                  $ref: '#/components/examples/recambio-example'
        '404':
          $ref: '#/components/responses/Response_404'
    options:
      summary: Proporciona la lista de los m√©todos HTTP soportados por esta ruta.
      description: Devuelve una cabecera `Allow` con la lista de m√©todos HTTP soportados (separados por comas).
      operationId: recambio_coptions
      tags: [ '‚öôÔ∏èInventario' ]
      responses:
        '204':
          description: 'cabecera `Allow` &lt;El cuerpo de la respuesta est√° vac√≠o&gt;'
          headers:
            Allow:
              $ref: '#/components/headers/Allow'
    post:
      summary: A√±ade un nuevo recambio
      description: |
        La siguiente tabla define los c√≥digos de estado que puede devolver este endpoint
        
        | Status Code | Descripci√≥n          | Motivo                                    |
        | ------------| ---------------------| ------------------------------------------|
        | **201**     | CREATED              | El recambio ha sido creado                |
        | **400**     | BAD REQUEST          | El identificador √∫nico ya existe          |
        | **422**     | UNPROCESSABLE ENTITY | Falta alguno de los atributos obligatorios|
        |             |                      | o el valor no est√° permitido              |
      tags: [ '‚öôÔ∏èInventario' ]
      operationId: recambio_post
      requestBody:
        $ref: '#/components/requestBodies/recambioRB'
      responses:
        '201':
          description: Nuevo Recambio creado
          headers:
            Location:
              $ref: '#/components/headers/Location'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Recambio'
        '400':
          $ref: '#/components/responses/Response_400'
        '422':
          $ref: '#/components/responses/Response_422'
   
components:
  schemas:
    Recambio: 
      title: '‚öôÔ∏è Recambio de un art√≠culo del taller'
      description: >
        Un recambio de un taller de veh√≠culos se refiere a la sustituci√≥n de una pieza o componente
        da√±ado o desgastado en un veh√≠culo por uno nuevo o reemplazo. Los talleres de veh√≠culos
        ofrecen una amplia variedad de recambios para distintas marcas y modelos de veh√≠culos,
        desde elementos tan b√°sicos como las buj√≠as hasta componentes m√°s complejos como motores y transmisiones.
      type: object
      properties:
        Recambio:
          type: object
          required: [numero_serie, nombre, descripcion, proveedor, equivalencias, garantia, precio, iva, importe, cantidad]
          properties:
            numero_serie:
              $ref: '#/components/schemas/Numero_Serie'
            nombre:
              $ref: '#/components/schemas/Nombre_Recambio'
            descripcion:
              $ref: '#/components/schemas/Descripcion_Recambio'
            proveedor:
              $ref: '#/components/schemas/Proveedor_Recambio'
            equivalencias:
              $ref: '#/components/schemas/Equivalencias_Recambio'
            garantia:
              $ref: '#/components/schemas/Garantia_Recambio'
            precio: 
              $ref: '#/components/schemas/Precio_Recambio'
            iva:
              $ref: '#/components/schemas/IVA_Recambio'
            importe:
              $ref: '#/components/schemas/Importe_Recambio'
            cantidad: 
              $ref: '#/components/schemas/Cantidad_Recambio'
   
    Numero_Serie:
      title: 'Numero de serie'
      description: >
        C√≥digo alfanum√©rico que permite identificar un recambio
      type: string
      pattern: '/^[A-Z]{1}[0-9]{7}-[A-Z]$/'
      example: "Z0000001-A"
      # https://v6.fakerjs.dev/guide/
      x-faker: helpers.regexpStyleStringParse('/^[A-Z]{1}[0-9]{7}-[A-Z]$/')
      
    Nombre_Recambio:
      title: 'Nombre recambio'
      type: string
      
    Descripcion_Recambio:
      title: 'Descripcion'
      description: >
        Explicaci√≥n detallada de las caracter√≠sticas, funciones y especificaciones
        t√©cnicas de una pieza o componente de repuesto para un veh√≠culo. Esta descripci√≥n
        es importante para asegurarse de que el recambio es adecuado para el veh√≠culo y 
        para comprender su funci√≥n dentro del mismo.
      type: string
      
    Proveedor_Recambio:
      title: 'Proveedor del recambio'
      description: >
        El proveedor de un recambio para un taller de veh√≠culos puede ser una empresa
        especializada en la fabricaci√≥n y distribuci√≥n de piezas de repuesto para autom√≥viles
        o bien un distribuidor que suministre los repuestos de diferentes fabricantes. 
      type: string
      
    Equivalencias_Recambio:
      title: 'Equivalencias'
      description: >
        Las equivalencias de un recambio para un veh√≠culo se refieren a piezas o componentes que,
        aunque no sean exactamente iguales en dise√±o o especificaciones t√©cnicas a la pieza 
        original del veh√≠culo, pueden ser utilizadas como reemplazo para dicha pieza.
      type: string
      items:
        type: object
        properties:
          nombre: 
            type: string
            description: 'Nombre de la pieza equivalente'
          fabricante:
            type: string
            description: 'Nombre del fabricante de la pieza equivalente'
          modelo:
            type: string
            description: 'Modelo de veh√≠culo compatible con la pieza equivalente'
             
    Garantia_Recambio:
      title: 'Garant√≠a del recambio'
      description: >
        La garant√≠a de un recambio de un veh√≠culo es un compromiso que el fabricante o vendedor 
        del recambio adquiere con el comprador, en el que se asegura que el recambio funcionar√° 
        de manera adecuada y sin defectos durante un periodo de tiempo determinado.
      type: string
      
    Precio_Recambio:
      title: 'Precio'
      description: 'Precio sin IVA asignado a cada recambio'
      type: number
      format: double
      minimum: 0
      exclusiveMinimum: true
      
    IVA_Recambio:
      title: 'IVA '
      description: >
        Es un tributo de car√°cter indirecto. Recae sobre los consumidores,
        puesto que lo pagan al adquirir un producto o servicio: sobre el precio neto 
        de los mismos se establece una aplicaci√≥n que var√≠a en su porcentaje.
      type: string
      pattern: '/^[0-9]{1,2}[%]$/'
      example: '21%'
        # https://v6.fakerjs.dev/guide/
      x-faker: helpers.regexpStyleStringParse('/^[0-9]{1,2}[%]$/')
      
    Importe_Recambio:
      title: 'Importe'
      description: 'Precio final a√±adiendo el IVA al precio a cada recambio'
      type: number
      format: double
      minimum: 0
      exclusiveMinimum: true
      
    Cantidad_Recambio:
      title: 'Cantidad'
      description: 'N√∫mero de unidades del recambio disponibles en el taller'
      type: integer
      minimum: 0
      maximum: 10000

    HTTP_Problem:
      type: object
      externalDocs:
        url: https://tools.ietf.org/html/rfc7807
      description: |
        Problem Details for HTTP APIs
        [https://tools.ietf.org/html/rfc7807](https://tools.ietf.org/html/rfc7807)
      properties:
        type:
          type: string
          format: uri
          description: A URI reference [RFC3986] that identifies the problem type
        title:
          type: string
          description: short human-readable summary of the problem type
        status:
          type: number
          description: HTTP status code
        detail:
          type: string
          description: Human-readable explanation specific to this occurrence of the problem
        instance:
          type: string
          format: uri
          description: >
            A URI reference that identifies the specific occurrence of the problem.
            It may or may not yield further information if dereferenced.
    
  headers:
    Etag:
      description: "Entitiy tag (Identificador √∫nico proporcionado para validaci√≥n de cach√©)"
      schema:
        type: string
        pattern: "[0-9a-f]*"
        example:
          35c3d556o23utew
    Allow:
      description: "Lista de m√©todos HTTP soportados"
      schema:
        type: string
      example: GET, DELETE, PUT, OPTIONS
    Location:
      description: '`URI` del nuevo recurso'
      schema:
        type: string
        format: uri
        x-facker: internet.url
        example:
          https://example.com/api/v1/recambios/
 
  parameters:
    Nombre_Recambio:
      name: Nombre_Recambio
      in: path
      description: Nombre del recambio correspondiente a un art√≠culo del taller
      required: true
      schema:
        $ref: '#/components/schemas/Nombre_Recambio'

    Proveedor_Recambio:
      name: Proveedor_Recambio
      in: path
      description: El proveedor de un recambio para el taller de veh√≠culos
      required: true
      schema:
        $ref: '#/components/schemas/Proveedor_Recambio'

    Equivalencias_Recambio:
      name: Equivalencias_Recambio
      in: query
      description: equivalencias de un recambio para un veh√≠culo
      required: false
      schema:
        $ref: '#/components/schemas/Equivalencias_Recambio'
    
    Importe_Recambio:
      name: Importe_Recambio
      in: query
      description: Precio final a√±adiendo el IVA al precio a cada recambio
      required: false
      schema:
        $ref: '#/components/schemas/Importe_Recambio'

    Cantidad_Recambio:
      name: Cantidad_Recambio
      in: query
      description: N√∫mero de unidades del recambio disponibles en el taller
      required: false
      schema:
        $ref: '#/components/schemas/Cantidad_Recambio'

    ifMatchParam:
      name: If-Match
      in: header
      description: ETag actual del recurso que se desea modificar
      required: true
      schema:
        type: string
        pattern: "[0-9a-f]*"

  requestBodies:
    recambioRB:
      description: Informaci√≥n del nuevo recambio
      required: true
      content:
        application/json:
          schema:
            type: object
            required: [numero_serie, nombre, proveedor, garantia, precio, iva, cantidad]
            properties:
              numero_serie:
                $ref: '#/components/schemas/Numero_Serie'
              nombre:
                $ref: '#/components/schemas/Nombre_Recambio'
              descripcion:
                $ref: '#/components/schemas/Descripcion_Recambio'
              proveedor:
                $ref: '#/components/schemas/Proveedor_Recambio'
              equivalencias:
                $ref: '#/components/schemas/Equivalencias_Recambio'
              garantia:
                $ref: '#/components/schemas/Garantia_Recambio'
              precio: 
                $ref: '#/components/schemas/Precio_Recambio'
              iva:
                $ref: '#/components/schemas/IVA_Recambio'
              importe:
                $ref: '#/components/schemas/Importe_Recambio'
              cantidad:
                $ref: '#/components/schemas/Cantidad_Recambio'
    recambioUpdate:
      description: Nuevos atributos del recambio
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              nombre:
                $ref: '#/components/schemas/Nombre_Recambio'
              descripcion:
                $ref: '#/components/schemas/Descripcion_Recambio'
              proveedor:
                $ref: '#/components/schemas/Proveedor_Recambio'
              equivalencias:
                $ref: '#/components/schemas/Equivalencias_Recambio'
              garantia:
                $ref: '#/components/schemas/Garantia_Recambio'
              precio: 
                $ref: '#/components/schemas/Precio_Recambio'
              iva:
                $ref: '#/components/schemas/IVA_Recambio'
              importe:
                $ref: '#/components/schemas/Importe_Recambio'
              cantidad: 
                $ref: '#/components/schemas/Cantidad_Recambio'
          example: { "precio": 19.95, "cantidad": 50 }

  responses: 
    Response_400:
      description: '`BAD REQUEST`: El identificador √∫nico ya existe'
      content: 
        application/problem+json:
          schema:
            $ref: '#/components/schemas/HTTP_Problem'
          examples:
            response-http-400:
              $ref: '#/componentes/examples/response-http-400'
    Response_404:
      description: '`NOT FOUND`: Recurso no disponbible'
      content: 
        application/problem+json:
          schema:
            $ref: '#/components/schemas/HTTP_Problem'
          examples:
            response-http-404:
              $ref: '#/components/examples/response-http-404'
    Response_409:
      description: '`CONFLICT`: El recurso no re√∫ne las condiciones adecuadas'
      content: 
        application/problem+json:
          schema:
            $ref: '#/components/schemas/HTTP_Problem'
          examples:
            response-http-409:
              $ref: '#/components/examples/response-http-409'
    Response_412:
      description: '`PRECONDITION FAILED`: El ETag proporcionado no est√° actualizado'
      content: 
        application/problem+json:
          schema:
            $ref: '#/components/schemas/HTTP_Problem'
          examples:
            response-http-412:
              $ref: '#/components/examples/response-http-412' 
    Response_422:
      description: '`UNPROCESSABLE ENTITY`: Falta alguno de los atributos obligatorios o son incorrectos'
      content: 
        application/problem+json:
          schema:
            $ref: '#/components/schemas/HTTP_Problem'
          examples:
            response-http-422:
              $ref: '#/components/examples/response-http-422'
